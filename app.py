import streamlit as st

# é è¨­æ¨è–¦é‚è¼¯åŠæˆåˆ†èªªæ˜
recommendation_rules = {
    "é—œç¯€ä¿é¤Š": ["UC-II", "è–‘é»ƒç´ ", "è‘¡è„ç³–èƒº", "MSM"],
    "ç¡çœ å“è³ª": ["GABA", "è‰²èƒºé…¸", "è¤ªé»‘æ¿€ç´ "],
    "ç¾å®¹æŠ—è€": ["è† åŸè›‹ç™½", "ç¶­ç”Ÿç´ C", "ç»å°¿é…¸"],
    "å…ç–«åŠ›æå‡": ["ç¶­ç”Ÿç´ C", "é‹…", "ç›Šç”ŸèŒ"],
    "å¿ƒè¡€ç®¡ä¿é¤Š": ["é­šæ²¹", "ç´è±†æ¿€é…¶", "ç´…éº´"],
    "æ’ä¾¿ä¸é †/è…¸èƒƒä¿å¥": ["ç›Šç”ŸèŒ", "æ´‹è»Šå‰å­æ®¼", "ä¹³é…¸èŒ", "é…µç´ "],
    "è¦–åŠ›ä¿å¥": ["è‘‰é»ƒç´ ", "ç‰ç±³é»ƒç´ ", "è¦ç´…ç´ ", "ç¶­ç”Ÿç´ A"],
    "è¡€ç³–æ§åˆ¶": ["è‹¦ç“œèƒœè‚½", "é‰»", "è‚‰æ¡‚èƒå–", "ç™½è…è±†èƒå–"],
    "éæ•é«”è³ª": ["ç›Šç”ŸèŒ", "ç¶­ç”Ÿç´ C", "é­šæ²¹", "èºæ—‹è—»"]
}

supplement_descriptions = {
    "UC-II": "å¹«åŠ©è»Ÿéª¨ä¿®å¾©ï¼Œæ¸›ç·©é—œç¯€ç–¼ç—›èˆ‡åƒµç¡¬ã€‚",
    "è–‘é»ƒç´ ": "å¼·æ•ˆæŠ—ç™¼ç‚æˆåˆ†ï¼Œæ”¹å–„é—œç¯€ä¸é©ã€‚",
    "è‘¡è„ç³–èƒº": "ä¿ƒé€²è»Ÿéª¨åˆæˆï¼Œç¶­æŒé—œç¯€å¥åº·ã€‚",
    "MSM": "æ¸›è¼•é—œç¯€ç‚ç—‡ç‹€ï¼Œæ”¹å–„éˆæ´»åº¦ã€‚",
    "GABA": "å¤©ç„¶é®éœåŠ‘ï¼Œå¹«åŠ©æ”¾é¬†èˆ‡ç¡çœ ã€‚",
    "è‰²èƒºé…¸": "ä¿ƒé€²è¡€æ¸…ç´ ç”Ÿæˆï¼Œæ”¹å–„ç¡çœ å“è³ªã€‚",
    "è¤ªé»‘æ¿€ç´ ": "èª¿ç¯€ç”Ÿç†æ™‚é˜ï¼Œå¹«åŠ©å…¥çœ ã€‚",
    "è† åŸè›‹ç™½": "ç¶­æŒçš®è†šå½ˆæ€§ï¼Œæ¸›ç·©è€åŒ–ã€‚",
    "ç¶­ç”Ÿç´ C": "æŠ—æ°§åŒ–ï¼Œä¿ƒé€²è† åŸè›‹ç™½åˆæˆï¼Œæå‡å…ç–«åŠ›ã€‚",
    "ç»å°¿é…¸": "ä¿æ¿•æ»‹æ½¤çš®è†šèˆ‡é—œç¯€è»Ÿéª¨ã€‚",
    "é‹…": "å¢å¼·å…ç–«ç³»çµ±åŠŸèƒ½ï¼Œä¿ƒé€²å‚·å£ç™’åˆã€‚",
    "ç›Šç”ŸèŒ": "ç¶­æŒè…¸é“èŒå¢å¹³è¡¡ï¼Œä¿ƒé€²æ¶ˆåŒ–å¥åº·ã€‚",
    "é­šæ²¹": "å¯Œå«Omega-3è„‚è‚ªé…¸ï¼Œé™ä½ç™¼ç‚åæ‡‰ã€‚",
    "ç´è±†æ¿€é…¶": "ä¿ƒé€²è¡€æ¶²å¾ªç’°ï¼Œé™ä½è¡€æ “é¢¨éšªã€‚",
    "ç´…éº´": "èª¿ç¯€è¡€è„‚ï¼Œæœ‰åŠ©å¿ƒè¡€ç®¡å¥åº·ã€‚",
    "æ´‹è»Šå‰å­æ®¼": "ä¿ƒé€²è…¸é“è •å‹•ï¼Œæ”¹å–„ä¾¿ç§˜ã€‚",
    "ä¹³é…¸èŒ": "å¹«åŠ©æ¶ˆåŒ–èˆ‡å…ç–«èª¿ç¯€ã€‚",
    "é…µç´ ": "åˆ†è§£é£Ÿç‰©ï¼Œæå‡å¸æ”¶æ•ˆç‡ã€‚",
    "è‘‰é»ƒç´ ": "ä¿è­·è¦–ç¶²è†œï¼Œé é˜²é»ƒæ–‘éƒ¨ç—…è®Šã€‚",
    "ç‰ç±³é»ƒç´ ": "æŠ—æ°§åŒ–ï¼Œä¿è­·çœ¼ç›å¥åº·ã€‚",
    "è¦ç´…ç´ ": "å¼·æ•ˆæŠ—æ°§åŒ–ï¼Œæ¸›ç·©è¦–åŠ›é€€åŒ–ã€‚",
    "ç¶­ç”Ÿç´ A": "ç¶­æŒè¦–åŠ›æ­£å¸¸ï¼Œæ”¯æŒå…ç–«ç³»çµ±ã€‚",
    "è‹¦ç“œèƒœè‚½": "å¹«åŠ©èª¿ç¯€è¡€ç³–å¹³è¡¡ã€‚",
    "é‰»": "ä¿ƒé€²èƒ°å³¶ç´ ä½œç”¨ï¼Œç©©å®šè¡€ç³–ã€‚",
    "è‚‰æ¡‚èƒå–": "æ”¹å–„èƒ°å³¶ç´ æ•æ„Ÿæ€§ï¼Œèª¿ç¯€è¡€ç³–ã€‚",
    "ç™½è…è±†èƒå–": "æŠ‘åˆ¶æ¾±ç²‰åˆ†è§£ï¼Œå¹«åŠ©æ§ç³–ã€‚",
    "èºæ—‹è—»": "å¤©ç„¶æŠ—æ°§åŒ–ï¼Œæå‡å…ç–«åŠ›ï¼Œæ¸›è¼•éæ•åæ‡‰ã€‚",
    # æ–°å¢å€‹äººåŒ–èª¿æ•´ä¸­ç”¨åˆ°çš„æˆåˆ†
    "éˆ£è³ª": "å¼·åŒ–éª¨éª¼çµæ§‹ï¼Œé é˜²éª¨è³ªç–é¬†ã€‚",
    "ç¶­ç”Ÿç´ D": "ä¿ƒé€²éˆ£å¸æ”¶ï¼Œç¶­æŒéª¨éª¼å¥åº·ã€‚",
    "é»‘å‡éº»": "ç·©è§£å¥³æ€§æ›´å¹´æœŸç—‡ç‹€ï¼Œèª¿ç¯€è·çˆ¾è’™ã€‚",
    "å¤§è±†ç•°é»ƒé…®": "æ¤ç‰©æ€§é›Œæ¿€ç´ ï¼Œæœ‰åŠ©å¥³æ€§æ›´å¹´æœŸå¥åº·ã€‚"
}

def adjust_recommendations(recommended, age, gender, pregnant, chronic):
    warnings = []

    # è€å¹´äººåŠ å¼·éª¨éª¼ä¿é¤Š
    if age >= 65:
        recommended.add("éˆ£è³ª")
        recommended.add("ç¶­ç”Ÿç´ D")

    # å¥³æ€§æ›´å¹´æœŸï¼ˆ45-60æ­²å¥³æ€§ï¼‰å»ºè­°éª¨éª¼èˆ‡è·çˆ¾è’™èª¿ç¯€
    if gender == "å¥³" and 45 <= age <= 60:
        recommended.add("é»‘å‡éº»")
        recommended.add("å¤§è±†ç•°é»ƒé…®")

    # å­•å©¦é¿å…ç‰¹å®šæˆåˆ†
    if pregnant:
        if "è¤ªé»‘æ¿€ç´ " in recommended:
            recommended.remove("è¤ªé»‘æ¿€ç´ ")
            warnings.append("âš ï¸ è¤ªé»‘æ¿€ç´ å­•å©¦ä¸å»ºè­°ä½¿ç”¨")
        # å¯åœ¨æ­¤æ“´å……å…¶ä»–å­•å©¦ç¦å¿Œ

    # æ…¢æ€§ç—…é¿å…ç´…éº´
    if chronic and "ç´…éº´" in recommended:
        recommended.remove("ç´…éº´")
        warnings.append("âš ï¸ ç´…éº´ä¸é©åˆæœ‰è‚è‡Ÿæˆ–æ…¢æ€§ç—…å•é¡Œè€…")

    return recommended, warnings


st.title("ğŸ§¬ å€‹äººåŒ–ä¿å¥é£Ÿå“å»ºè­°å•å·")

# åŸºæœ¬è³‡æ–™è¼¸å…¥
age = st.number_input("è«‹è¼¸å…¥æ‚¨çš„å¹´é½¡ï¼š", min_value=1, max_value=120, value=40)
gender = st.radio("è«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥ï¼š", ["ç”·", "å¥³"])

# é¸æ“‡å¥åº·ç›®æ¨™
health_goals = st.multiselect(
    "æ‚¨ç›®å‰æœ€é—œæ³¨çš„å¥åº·é¢å‘ï¼ˆå¯è¤‡é¸ï¼‰ï¼š",
    list(recommendation_rules.keys())
)

# ç‰¹æ®Šç‹€æ³
pregnant = st.checkbox("ç›®å‰æ‡·å­•æˆ–å“ºä¹³ä¸­")
chronic = st.checkbox("æœ‰æ…¢æ€§ç–¾ç—…ï¼ˆå¦‚ç³–å°¿ç—…ã€é«˜è¡€å£“ï¼‰")

# é¡¯ç¤ºå»ºè­°
if st.button("ğŸ” ç”¢ç”Ÿå»ºè­°"):
    if not health_goals:
        st.warning("è«‹å…ˆé¸æ“‡è‡³å°‘ä¸€å€‹å¥åº·é¢å‘")
    else:
        st.subheader("âœ… æ ¹æ“šæ‚¨çš„æƒ…æ³ï¼Œå»ºè­°è£œå……ä»¥ä¸‹æˆåˆ†ï¼š")
        recommended = set()
        for goal in health_goals:
            for item in recommendation_rules[goal]:
                recommended.add(item)

        # ä¾å¹´é½¡ã€æ€§åˆ¥ã€ç‰¹æ®Šç‹€æ³èª¿æ•´æ¨è–¦
        recommended, warnings = adjust_recommendations(recommended, age, gender, pregnant, chronic)

        # é¡¯ç¤ºæ¨è–¦æˆåˆ†èˆ‡èªªæ˜
        for supp in recommended:
            desc = supplement_descriptions.get(supp, "ç„¡èªªæ˜è³‡æ–™")
            st.markdown(f"**{supp}** ï¼ {desc}")

        if warnings:
            st.markdown("---")
            st.warning("\n".join(warnings))
